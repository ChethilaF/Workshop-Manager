{% extends "layout.html" %}

{% block extra_css %}
<!-- Page-specific CSS -->
<link rel="stylesheet" href="{{ url_for('static', filename='css/weekly_summary_dashboard.css') }}">
<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
{% endblock %}

{% block title %}Weekly Summary PDFs{% endblock %}

{% block content %}
<h2>Weekly Summary PDFs</h2>

<div class="tech-grid">
    {% for tech in techs %}
    <div class="tech-circle" id="tech-{{ tech.id }}">
        <span>{{ tech.name }}</span>

        <!-- Hidden PDF list & actions -->
        <div class="pdf-content" style="display: none;">
            {% set pdfs = get_pdfs_for_tech(tech.id) %}
            {% if pdfs %}
            <ul class="pdf-list">
                {% for pdf in pdfs %}
                <li class="pdf-item">
                    <span>{{ pdf }}</span>
                    <a href="{{ url_for('main.download_pdf', filename=pdf) }}" class="btn-download" aria-label="Download {{ pdf }}">
                        <i class="fas fa-download"></i> Download
                    </a>
                </li>
                {% endfor %}
            </ul>
            {% else %}
            <p>No PDFs generated yet.</p>
            {% endif %}

            <!-- Generate new weekly summary PDF -->
            <form action="{{ url_for('main.generate_weekly_summary', tech_id=tech.id) }}" method="POST">
                <button type="submit" class="btn-generate" aria-label="Generate weekly summary PDF for {{ tech.name }}">
                    <i class="fas fa-file-pdf"></i> Generate PDF
                </button>
            </form>
        </div>
    </div>
    {% endfor %}
</div>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener("DOMContentLoaded", () => {
  const circles = document.querySelectorAll(".tech-circle");

  circles.forEach(circle => {
    circle.setAttribute("tabindex", "0");

    function toggleCircle() {
      circles.forEach(c => {
        if (c !== circle) {
          c.classList.remove("expanded");
          const pdf = c.querySelector(".pdf-content");
          if (pdf) pdf.style.display = "none";
        }
      });

      circle.classList.toggle("expanded");
      const pdfContent = circle.querySelector(".pdf-content");
      if (pdfContent) {
        pdfContent.style.display =
          pdfContent.style.display === "block" ? "none" : "block";
      }
    }

    circle.addEventListener("click", e => {
      if (e.target.closest("a, button")) return;
      toggleCircle();
    });

    circle.addEventListener("keydown", e => {
      if (e.key === "Enter" || e.key === " ") {
        e.preventDefault();
        toggleCircle();
      }
    });
  });
});
</script>
{% endblock %}
