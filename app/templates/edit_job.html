{% extends "layout.html" %}
{% block title %}Edit Job{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<link rel="stylesheet" href="{{ url_for('static', filename='css/job_actions.css') }}">
{% endblock %}

{% block content %}
<h2>Edit Job</h2>

<div class="body-content">
  <div class="job-form-container">
    <a href="{{ url_for('main.jobs') }}" class="back-button">
      <i class="fas fa-arrow-left"></i> Back
    </a>
    
    <!-- Edit Job form -->

    <form method="POST">
      <!-- Job description -->
      <div class="input-group">
        <label for="description"><i class="fas fa-briefcase"></i> Job Description</label>
        <input type="text" id="description" name="description" placeholder="Job description" required
          value="{{ job.job_description }}">
      </div>

      <!-- Start date -->
      <div class="input-group">
        <label for="start_date"><i class="fas fa-calendar-alt"></i> Start Date:</label>
        <input type="date" id="start_date" name="start_date"
          value="{{ job.start_date.strftime('%Y-%m-%d') if job.start_date else '' }}">
      </div>

      <!-- End date -->
      <div class="input-group">
        <label for="end_date"><i class="fas fa-calendar-check"></i> End Date:</label>
        <input type="date" id="end_date" name="end_date"
          value="{{ job.end_date.strftime('%Y-%m-%d') if job.end_date else '' }}">
      </div>

      <!-- Target duration -->
      <div class="input-group">
        <label><i class="fas fa-clock"></i> Target Duration:</label>
        <div class="duration-selects">
          <select name="target_hours">
            {% for h in range(0, 13) %}
            <option value="{{ h }}" {% if job and target_hours==h %}selected{% endif %}>
              {{ h }} hr{% if h != 1 %}s{% endif %}
            </option>
            {% endfor %}
          </select>
          <select name="target_minutes">
            {% for m in [0, 5, 10, 15, 20, 25, 30, 35, 40, 45, 50, 55] %}
            <option value="{{ m }}" {% if job and target_minutes==m %}selected{% endif %}>
              {{ m }} min
            </option>
            {% endfor %}
          </select>
        </div>
      </div>

      <!-- Status -->
      <div class="input-group">
        <label for="status"><i class="fas fa-tasks"></i> Status:</label>
        <select id="status" name="status">
          {% for s in ['Pending','In Progress','Completed'] %}
          <option value="{{ s }}" {% if job.status==s %}selected{% endif %}>{{ s }}</option>
          {% endfor %}
        </select>
      </div>

      <!-- Customer -->
      <div class="input-group">
        <label for="customer_id"><i class="fas fa-user"></i> Customer:</label>
        <select id="customer_id" name="customer_id">
          {% for customer in customers %}
          <option value="{{ customer.id }}" {% if job.customer_id==customer.id %}selected{% endif %}>{{ customer.name }}
          </option>
          {% endfor %}
        </select>
      </div>

      <!-- Technician -->
      <div class="input-group">
        <label for="technician_id"><i class="fas fa-wrench"></i> Technician:</label>
        <select id="technician_id" name="technician_id">
          {% for tech in technicians %}
          <option value="{{ tech.id }}" {% if job.technician_id==tech.id %}selected{% endif %}>{{ tech.name }}</option>
          {% endfor %}
        </select>
      </div>

      <!-- Vehicle Details -->
      <div class="input-group">
        <label for="vehicle_registration"><i class="fas fa-car"></i> Vehicle Registration:</label>
        <input type="text" id="vehicle_registration" name="vehicle_registration" value="{{ job.vehicle_registration }}">
      </div>
      <div class="input-group">
        <label for="vehicle_make"><i class="fas fa-car-side"></i> Vehicle Make:</label>
        <input type="text" id="vehicle_make" name="vehicle_make" value="{{ job.vehicle_make }}">
      </div>
      <div class="input-group">
        <label for="vehicle_model"><i class="fas fa-car"></i> Vehicle Model:</label>
        <input type="text" id="vehicle_model" name="vehicle_model" value="{{ job.vehicle_model }}">
      </div>
      <div class="input-group">
        <label for="vehicle_year"><i class="fas fa-calendar"></i> Vehicle Year:</label>
        <input type="number" id="vehicle_year" name="vehicle_year" value="{{ job.vehicle_year }}">
      </div>
      <div class="input-group">
        <label for="vehicle_color"><i class="fas fa-paint-brush"></i> Vehicle Color:</label>
        <input type="text" id="vehicle_color" name="vehicle_color" value="{{ job.vehicle_color }}">
      </div>

      <!-- Cost -->
      <div class="input-group">
        <label for="total_cost"><i class="fas fa-dollar-sign"></i> Total Cost:</label>
        <input type="number" id="total_cost" name="total_cost" step="0.01" value="{{ job.total_cost }}">
      </div>

      <!-- Notes -->
      <div class="input-group">
        <label for="notes"><i class="fas fa-info-circle"></i> Additional Notes:</label>
        <textarea id="notes" name="notes">{{ job.notes }}</textarea>
      </div>

      <!-- Submit button -->
      <button type="submit" class="submit-button">Update Job</button>
    </form>
  </div>
</div>
{% endblock %}