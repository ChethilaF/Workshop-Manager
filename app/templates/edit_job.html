{% extends "layout.html" %}
{% block title %}Edit Job{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<link rel="stylesheet" href="{{ url_for('static', filename='css/job_actions.css') }}">
{% endblock %}

{% block content %}
<h2>Edit Job</h2>

<div class="body-content">
  <div class="job-form-container">
    <a href="{{ url_for('main.jobs') }}" class="back-button">
      <i class="fas fa-arrow-left"></i> Back
    </a>

    <form method="POST">
      <!-- Job description -->
      <div class="input-group">
        <label for="description"><i class="fas fa-briefcase"></i> Job Description</label>
        <input type="text" id="description" name="description" required
               value="{{ request.form.get('description', job.job_description) }}">
      </div>

      <!-- Start & End Date -->
      <div class="input-group">
        <label for="start_date"><i class="fas fa-calendar-alt"></i> Start Date</label>
        <input type="date" id="start_date" name="start_date"
               value="{{ request.form.get('start_date', job.start_time.strftime('%Y-%m-%d') if job.start_time else '') }}">
      </div>
      <div class="input-group">
        <label for="end_date"><i class="fas fa-calendar-check"></i> End Date</label>
        <input type="date" id="end_date" name="end_date"
               value="{{ request.form.get('end_date', job.end_time.strftime('%Y-%m-%d') if job.end_time else '') }}">
      </div>

      <!-- Target Duration -->
      <div class="input-group">
        <label><i class="fas fa-clock"></i> Target Duration</label>
        <div class="duration-selects">
          <select name="target_days">
            {% for d in range(0, 365) %}
            <option value="{{ d }}" {% if request.form.get('target_days')|int==d or (not request.form.get('target_days') and target_days==d) %}selected{% endif %}>
              {{ d }} day{% if d != 1 %}s{% endif %}
            </option>
            {% endfor %}
          </select>
          <select name="target_hours">
            {% for h in range(0, 24) %}
            <option value="{{ h }}" {% if request.form.get('target_hours')|int==h or (not request.form.get('target_hours') and target_hours==h) %}selected{% endif %}>
              {{ h }} hr{% if h != 1 %}s{% endif %}
            </option>
            {% endfor %}
          </select>
          <select name="target_minutes">
            {% for m in [0,5,10,15,20,25,30,35,40,45,50,55,60] %}
            <option value="{{ m }}" {% if request.form.get('target_minutes')|int==m or (not request.form.get('target_minutes') and target_minutes==m) %}selected{% endif %}>
              {{ m }} min
            </option>
            {% endfor %}
          </select>
        </div>
      </div>

      <!-- Status -->
      <div class="input-group">
        <label for="status"><i class="fas fa-tasks"></i> Status</label>
        <select id="status" name="status">
          <option value="Pending" {% if request.form.get('status', job.status)=='Pending' %}selected{% endif %}>Pending</option>
          <option value="In Progress" {% if request.form.get('status', job.status)=='In Progress' %}selected{% endif %}>In Progress</option>
          <option value="Completed" {% if request.form.get('status', job.status)=='Completed' %}selected{% endif %}>Completed</option>
        </select>
      </div>

      <!-- Customer & Technician -->
      <div class="input-group">
        <label for="customer_id"><i class="fas fa-user"></i> Customer</label>
        <select id="customer_id" name="customer_id" required>
          {% for customer in customers %}
          <option value="{{ customer.id }}" {% if request.form.get('customer_id')|int==customer.id or (not request.form.get('customer_id') and customer.id==job.customer_id) %}selected{% endif %}>
            {{ customer.full_name }}
          </option>
          {% endfor %}
        </select>
      </div>
      <div class="input-group">
        <label for="technician_id"><i class="fas fa-wrench"></i> Technician</label>
        <select id="technician_id" name="technician_id" required>
          {% for tech in technicians %}
          <option value="{{ tech.id }}" {% if request.form.get('technician_id')|int==tech.id or (not request.form.get('technician_id') and tech.id==job.assigned_technician_id) %}selected{% endif %}>
            {{ tech.full_name }}
          </option>
          {% endfor %}
        </select>
      </div>

      <!-- Vehicle details -->
      <div class="input-group">
        <label for="vehicle_registration"><i class="fas fa-car"></i> Vehicle Registration</label>
        <input type="text" id="vehicle_registration" name="vehicle_registration" required
               value="{{ request.form.get('vehicle_registration', job.vehicle_registration) }}">
      </div>
      <div class="input-group">
        <label for="vehicle_make"><i class="fas fa-car-side"></i> Vehicle Make</label>
        <input type="text" id="vehicle_make" name="vehicle_make" value="{{ request.form.get('vehicle_make', job.vehicle_make) }}">
      </div>
      <div class="input-group">
        <label for="vehicle_model"><i class="fas fa-car-side"></i> Vehicle Model</label>
        <input type="text" id="vehicle_model" name="vehicle_model" value="{{ request.form.get('vehicle_model', job.vehicle_model) }}">
      </div>
      <div class="input-group">
        <label for="vehicle_year"><i class="fas fa-calendar"></i> Vehicle Year</label>
        <input type="number" id="vehicle_year" name="vehicle_year" value="{{ request.form.get('vehicle_year', job.vehicle_year) }}">
      </div>
      <div class="input-group">
        <label for="vehicle_color"><i class="fas fa-paint-brush"></i> Vehicle Color</label>
        <input type="text" id="vehicle_color" name="vehicle_color" value="{{ request.form.get('vehicle_color', job.vehicle_color) }}">
      </div>

      <!-- Cost & Notes -->
      <div class="input-group">
        <label for="total_cost"><i class="fas fa-dollar-sign"></i> Total Cost</label>
        <input type="number" id="total_cost" name="total_cost" step="0.01" value="{{ request.form.get('total_cost', job.total_cost) }}">
      </div>
      <div class="input-group">
        <label for="notes"><i class="fas fa-info-circle"></i> Additional Notes</label>
        <textarea id="notes" name="notes">{{ request.form.get('notes', job.notes) }}</textarea>
      </div>

      <button type="submit" class="submit-button">Update Job</button>
    </form>
  </div>
</div>
{% endblock %}
